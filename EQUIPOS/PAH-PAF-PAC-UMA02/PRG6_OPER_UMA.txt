REM PRG6_OPER-UMA
REM ACTIVACION DEL SISTEMA UMA02
REM AUTHOR CARLOS JIMENEZ HIRASHI
REM VERSION 1.0.0

REM DECLARACION DE VARIABLES

    LOCALS MODO, OCC		: REM (LECTURA) MODOS DE ACTIVACION
    LOCALS SYS				: REM (ESCRITURA) ACTIVACION DEL SISTEMA

REM VARIABLES DE ENTRADA

    MODO = MSV7		: REM MODO DE ACTICACION DEL SISTEMA (1)HORARIO (2)FUERA (3)MANUAL
    OCC = BV41		: REM ESTADO DE HORARIO DE OPERACION (0)INACTIVO (1)ACTIVO

REM MODO DE ARRANQUE DEL SISTEMA
    
    REM *(1)HORARIO, (2)FUERA, (3)MANUAL
	    IF MODO = 1 THEN
	    	IF OCC = 1 THEN SYS = 1 ELSE SYS = 0
	     ELSE
	    	IF MODO = 2 THEN
	    		SYS = 0
	    	 ELSE
	    		IF MODO = 3 THEN SYS = 1
	    	ENDIF
	    ENDIF

REM VARIABLES DE SALIDA

    BV38 = SYS		: REM ACTIVACION DEL SISTEMA (0)INACTIVO (1)ACTIVO

REM DECLARACION DE VARIABLES

    LOCALS ARRANQUE, SS_SF 				: REM ARRANQUE DE UMA 02
    LOCALS VEL1, VEL2, VEL3, VEL		: REM VELOCIDADES DEL SISTEMA
    LOCALS SV1, SV2, SV, SVT			: REM VELOCIDAD ACTIVA
    LOCALS CCV, HCV 					: REM ESTADO DE VALVULAS DE AGUA

REM VARIABLES DE ENTRADA

    ARRANQUE = BV38				: REM ARRANQUE DE SISTEMA
    VEL1 = 100					: REM VELOCIDAD DE VENTILADOR 1
    VEL2 = 100					: REM VELOCIDAD DE VENTILADOR 2
    VEL3 = 100					: REM VELOCIDAD DE VENTILADOR 3
    CCV = AO26					: REM VALVULA DE AGUA HELADA
    HCV = AO27					: REM VALVULA DE AGUA CALIENTE

REM CONTROL DE VELOCIDAD
	IF CCV > 95 OR HCV > 95 THEN
		START SV
		AV19 = 10
	 ELSE
		AV19 = 5
		IF CCV < 75 AND HCV < 75 THEN STOP SV
	ENDIF

	IF SV = 1 THEN
		IF TIMEON( SV ) > 90 THEN SV1 = 1
		IF TIMEON( SV ) > 180 THEN SV2 = 1
	 ELSE
		IF TIMEOFF( SV ) > 90 THEN SV2 = 0
		IF TIMEOFF( SV ) > 180 THEN SV1 = 0
	ENDIF

	SVT = SV1 + SV2
	IF SVT = 0 THEN VEL = VEL1
	IF SVT = 1 THEN VEL = VEL2
	IF SVT = 2 THEN VEL = VEL3

REM ACTIVACION DE SISTEMA
    IF ARRANQUE = 1 THEN SS_SF = VEL , BV42 = 1
    IF TIMEOFF( ARRANQUE ) > 60 THEN SS_SF = 0 , BV42 = 0

REM VARIABLES DE SALIDA

    AO25 = SS_SF
    AV20 = SVT

END
REM PRG10_ALARMAS
REM PROGRAMA PARA GENERACION DE ALARAMAS DEL SISTEMA
REM AUTHOR CARLOS JIMENEZ HIRASHI
REM VERSION 1.0.0

REM DECLARACION DE VARIABLES

    LOCALS ALM_BAF, ALM_BAH, ALM_BAC 			: REM ALARMAS DE BOMBAS
    LOCALS ALM_CHAF, A_CHAF, ALM_CHAH, A_CHAH 	: REM ALARMA DE CHILLERS
    LOCALS ALM_AF, ALM_AH, ALM_AC				: REM ALARMAS PLANTAS DE AGUA
    LOCALS ST_BAF, ST_BAH, ST_BAC 				: REM ESTADOS DE OPERACION DE BOMBAS
    LOCALS SS_BAF, SS_BAH, SS_BAC 				: REM ARRANQUES DE BOMBAS
    LOCALS ST_CHAF, ST_CHAH 					: REM ESTADOS DE OPERACION CHILERS
    LOCALS SS_CHAF, SS_CHAH 					: REM ARRANQUES DE CHILLERS

REM VARIABLES DE ENTRADA

    ST_BAF = BI7		: REM ESTADO OPERACION BOMBA DE AGUA FRIA
    ST_BAH = BI15		: REM ESTADO OPERACION BOMBA DE AGUA HELADA
    ST_BAC = BI26		: REM ESTADO OPERACION BOMBA DE AGUA CALIENTE
    SS_BAF = BO2		: REM ARRANQUE BOMBA DE AGUA FRIA
    SS_BAH = BO6		: REM ARRANQUE BOMBA DE AGUA HELADA
    SS_BAC = BO18		: REM ARRANQUE BOMBA DE AGUA CALIENTE

    ST_CHAF = BV44		: REM ESTADO DE OPERACION DE CHILLER AGUA FRIA
    SS_CHAF = BO1		: REM ARRANQUE DE CHILLER AGUA FRIA
    ST_CHAH = BV46		: REM ESTADO DE OPERACION DE CHILLER AGUA HELADA
    SS_CHAH	= BO5		: REM ARRANQUE DE CHILLER AGUA HELADA

    A_CHAF = BV45		: REM ALARMA DE CHILLER AGUA FRIA
    A_CHAH = BV47		: REM ALARMA DE CHILLER AGUA HELADA

REM ALARMAS DE SISTEMA

    REM *GESTOR DE ALARMAS DE PLANTA DE AGUA FRIA
        
        REM **ALARMAS DE SISTEMA
            REM **BOMBA DE AGUA FRIA
	            IF TIMEON(SS_BAF) > 60 AND TIMEOFF(ST_BAF) > 20 THEN ALM_BAF = 1

            REM **CHILLER AGUA FRIA
	            IF TIMEON(SS_CHAF) > 60 AND TIMEOFF(ST_CHAF) > 20 THEN ALM_CHAF = 1 ELSE ALM_CHAF = 0

        REM **RESET DE ALARMAS
            REM **BOMBA DE AGUA FRIA (MSV4) RESET
	            IF MSV4 = 1 THEN ALM_BAF = 0 , MSV4@8 = 2

        REM **ALARMA DEL SISTEMA
	        IF ALM_BAF = 1 OR ALM_CHAF = 1 OR A_CHAF = 1 THEN ALM_AF = 1 ELSE ALM_AF = 0

        REM **BLOQUEO DEL SISTEMA (MSV1, BO2)
	        IF ALM_BAF = 1 THEN MSV1@4 = 2 , BO2@4 = 0 ELSE RLQ MSV1@4 , RLQ BO2@4

    REM *ALARMAS DE PLANTA DE AGUA HELADA

        REM **ALARMAS DE SISTEMA
            REM ***BOMBA DE AGUA HELADA
	            IF TIMEON(SS_BAH) > 60 AND TIMEOFF(ST_BAH) > 20 THEN ALM_BAH = 1

            REM ***CHILLER AGUA HELADA
	            IF TIMEON(SS_CHAH) > 60 AND TIMEOFF(ST_CHAH) > 20 THEN ALM_CHAH = 1 ELSE ALM_CHAH = 0

        REM **RESET DE ALARMAS
            REM ***BOMBA DE AGUA HELADA (MSV5) RESET
	            IF MSV5 = 1 THEN ALM_BAH = 0 , MSV5@8 = 2

        REM **ALARMA DEL SISTEMA
	        IF ALM_BAH = 1 OR ALM_CHAH = 1 OR A_CHAH = 1 THEN ALM_AH = 1 ELSE ALM_AH = 0

        REM **BLOQUEO DEL SISTEMA (MSV2, BO6)
	        IF ALM_BAH = 1 THEN MSV2@4 = 2 , BO6@4 = 0 ELSE RLQ MSV2@4 , RLQ BO6@4

    REM *ALARMAS DE PLANTA DE AGUA CALIENTE

        REM **ALARMAS DE SISTEMA
            REM ***BOMBA DE AGUA CALIENTE
	            IF TIMEON(SS_BAC) > 60 AND TIMEOFF(ST_BAC) > 20 THEN ALM_BAC = 1

        REM **RESET DE ALARMAS
            REM ***BOMBA DE AGUA CALIENTE (MSV6) RESET
	            IF MSV6 = 1 THEN ALM_BAC = 0 , MSV6@8 = 2

        REM **ALARMA DEL SISTEMA**
	        IF ALM_BAC = 1 THEN ALM_AC = 1 ELSE ALM_AC = 0

        REM **BLOQUEO DEL SISTEMA (MSV3, BO18)**
	        IF ALM_BAC = 1 THEN MSV3@4 = 2 , BO18@4 = 0 ELSE RLQ MSV3@4 , RLQ BO18@4

REM VARIABLES DE SALIDA

    BV9 = ALM_BAF
    BV10 = ALM_BAH
    BV11 = ALM_BAC
    BV12 = ALM_CHAF
    BV13 = ALM_CHAH
    BV14 = ALM_AF
    BV15 = ALM_AH
    BV16 = ALM_AC

END